<!DOCTYPE html>
<html lang="en">
<head> <meta charset="UTF-8" /> <title>ATS Legacy Pricing</title> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="robots" content="noindex,nofollow,noarchive" /> <link rel="icon" type="image/png" href="/assets/images/logo-v2.png"> <link rel="apple-touch-icon" href="/assets/images/logo-v2.png"> <style> :root{ --purple:#5b2aa8; --purple2:#3f1c83; --yellow:#FFD700; --muted:rgba(255,255,255,.86); --card:rgba(255,255,255,.10); --border:rgba(255,255,255,.18); --shadow: 0 12px 30px rgba(0,0,0,.22); --r-lg: 18px; --r-md: 14px; --r-sm: 12px; } *{ box-sizing:border-box; } body{ margin:0; font-family: system-ui, -apple-system,"Segoe UI", Roboto, Arial, sans-serif; color:#fff; background: linear-gradient(135deg, var(--purple), var(--purple2)); min-height:100vh; } .topbar{ padding:18px; display:flex; align-items:center; justify-content:space-between; gap:12px; } .brand{ display:flex; align-items:center; gap:12px; } .brand-logo{ width:44px;height:44px;border-radius:14px;border:1px solid var(--border); background: rgba(255,255,255,.12); box-shadow: var(--shadow); overflow:hidden;display:flex;align-items:center;justify-content:center; } .brand-logo img{ width:100%;height:100%;object-fit:cover;display:block; } .title{ font-weight:800; font-size:18px; } .sub{ font-size:12px; color: rgba(255,255,255,.86); margin-top:4px; } #who{ font-size:12px; color: rgba(255,255,255,.86); text-align:right; white-space:nowrap; } .accentline{ height:6px;background:var(--yellow);border-radius:999px;margin:0 18px; } .wrap{ max-width: 900px; margin: 0 auto; padding: 18px; } .status{ margin: 16px 0 18px; padding: 14px; border-radius: var(--r-md); background: rgba(255,255,255,.10); border: 1px solid var(--border); font-size: 14px; white-space: pre-wrap; line-height:1.45; box-shadow: var(--shadow); } .status.is-loading{ opacity: .9; } .status.is-success{ border-color: rgba(34,197,94,.45); background: rgba(34,197,94,.14); } .status.is-error{ border-color: rgba(239,68,68,.45); background: rgba(239,68,68,.14); } .card{ background: var(--card); border: 1px solid var(--border); border-radius: var(--r-lg); padding: 18px; box-shadow: var(--shadow); margin-bottom: 14px; } .card h3{ margin:0 0 8px; font-size:16px; font-weight:800; } .card p{ margin:0 0 14px; color: var(--muted); font-size:13px; line-height:1.55; } label{ display:block; font-size:12px; color: rgba(255,255,255,.85); margin: 10px 0 6px; } input, select{ width:100%; padding: 13px 12px; border-radius: var(--r-sm); border: 1px solid var(--border); background: rgba(0,0,0,.15); color:#fff; outline:none; font-size:14px; } .btn{ width:100%; padding: 14px; min-height: 48px; border-radius: var(--r-sm); background: var(--yellow); color:#111; font-weight:800; border:0; cursor:pointer; } .btn.secondary{ background: rgba(0,0,0,.22); color:#fff; border:1px solid var(--border); } .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; } @media (max-width: 800px){ .row{ grid-template-columns: 1fr; } } .outgrid{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; } @media (max-width: 800px){ .outgrid{ grid-template-columns: 1fr; } } .kv{ display:flex; justify-content:space-between; gap:12px; padding: 10px 12px; border-radius: var(--r-sm); border:1px solid var(--border); background: rgba(0,0,0,.12); } .kv b{ font-weight:800; } .links a{ color: var(--yellow); font-weight: 800; text-decoration: none; } </style> <link rel="stylesheet" href="/admin/admin-layout.css" /> <script defer src="/admin/admin-nav.js"></script>
</head>
<body class="ats-admin"> <header class="ats-header"> <div class="ats-header-inner"> <a class="ats-brand" href="/admin/" aria-label="Go to Admin Home"> <img src="/assets/images/logo-v2.png" alt="About To Shine Cleaning Logo" /> </a> <div class="ats-header-actions"> <a class="ats-live-btn" href="https://abouttoshinecleaning.com" target="_blank" rel="noopener">Go to Live Website</a> <button class="ats-burger" type="button" aria-label="Open menu" aria-haspopup="dialog" aria-controls="atsNavDrawer" aria-expanded="false"> <span></span><span></span><span></span> </button> </div> </div>
</header> <main class="ats-main"><div class="ats-container">
<div class="topbar"> <div class="brand"> <div class="brand-logo"><img src="/assets/images/logo-v2.png" alt=""></div> <div> <div class="title">About To Shine Cleaning</div> <div class="sub">Legacy Pricing (Admin)</div> </div> </div> <div class="sub" id="who"></div> </div> <div class="accentline"></div> <div class="wrap"> <div class="status is-loading" id="status">Loading…</div> <div class="card"> <h3>Inputs</h3> <p>Tap <b>Adjust</b> to preview. Then <b>Save + Generate PDF</b> to log + create Doc/PDF in Drive.</p> <label for="saveAs">Save As (required for PDF)</label> <input id="saveAs" placeholder='Example:"RL Reppert increase"' /> <label for="clientName">Client name (optional)</label> <input id="clientName" placeholder="Legacy Client" /> <div class="row"> <div> <label for="billingMethod">Billing method</label> <select id="billingMethod"> <option>Weekly rate</option> <option>Monthly total</option> </select> </div> <div> <label for="currentAmount">Current amount</label> <input id="currentAmount" type="number" step="0.01" value="160" /> </div> </div> <div class="row"> <div> <label for="weeksPerMonth">Weeks per invoice month</label> <select id="weeksPerMonth"> <option value="4">4</option> <option value="4.33">4.33</option> <option value="5">5</option> </select> </div> <div> <label for="taxRate">Sales tax rate</label> <select id="taxRate"> <option value="0.06">6%</option> <option value="0.07">7%</option> <option value="0.08">8%</option> <option value="0">0%</option> </select> </div> </div> <label for="strategy">Strategy</label> <select id="strategy"> <option>Keep client total same (absorb tax)</option> <option>Add $ per week</option> <option>Add $ per month</option> <option selected>Client pays % of tax (split)</option> <option>Target my net revenue % (after tax)</option> </select> <div class="row"> <div> <label for="addPerWeek">Add $ per week</label> <input id="addPerWeek" type="number" step="0.01" value="0" /> </div> <div> <label for="addPerMonth">Add $ per month</label> <input id="addPerMonth" type="number" step="0.01" value="0" /> </div> </div> <div class="row"> <div> <label for="clientTaxShare">Client pays % of tax</label> <select id="clientTaxShare"> <option value="0">0%</option> <option value="0.25">25%</option> <option value="0.5" selected>50%</option> <option value="0.75">75%</option> <option value="1">100%</option> </select> </div> <div> <label for="targetNetPct">Target net revenue %</label> <select id="targetNetPct"> <option value="0.9">90%</option> <option value="0.95">95%</option> <option value="1" selected>100%</option> <option value="1.05">105%</option> <option value="1.1">110%</option> </select> </div> </div> <div style="margin-top:14px;"></div> <button class="btn" id="btnAdjust">Adjust</button> <div style="height:10px;"></div> <button class="btn secondary" id="btnExport">Save + Generate PDF</button> <div class="sub" style="margin-top:10px;">API: <span id="apiHint"></span></div> </div> <div class="card" id="outputsCard" style="display:none;"> <h3>Outputs</h3> <p id="explain" class="sub" style="margin:0 0 12px;"></p> <div class="outgrid"> <div class="kv"><b>Service subtotal (taxable base)</b><span id="o_base"></span></div> <div class="kv"><b>Sales tax line item</b><span id="o_tax"></span></div> <div class="kv"><b>Total due</b><span id="o_total"></span></div> <div class="kv"><b>Weekly total</b><span id="o_weekly"></span></div> <div class="kv"><b>Old base (pre-tax)</b><span id="o_old"></span></div> <div class="kv"><b>Pass-through increase</b><span id="o_pass"></span></div> <div class="kv"><b>Client absorbs (monthly)</b><span id="o_clientabs"></span></div> <div class="kv"><b>Business absorbs (monthly)</b><span id="o_bizabs"></span></div> </div> <div class="sub links" id="links" style="margin-top:10px;"></div> </div> </div> <script> // Uses your Admin Panel sessionStorage sign-in const AUTH_STORAGE ="ats_admin_auth_v1"; const TOKEN_STORAGE ="ats_admin_token_v1"; const TOKEN_LOCAL ="ats_admin_token_local_v1"; // ✅ PUT YOUR /exec URL HERE (ONLY HERE) const LEGACY_API_URL ="https://script.google.com/macros/s/AKfycbxxlswMSBSpXO9KqptzOULfDFCOmiu0dqGmMDDIY4IX-3EHqMkauIvAfNrUq0_rsbrN/exec"; const el = (id) => document.getElementById(id); const statusEl = el("status"); const whoEl = el("who"); const apiHint = el("apiHint"); function setStatus(msg, state){ statusEl.textContent = msg ||""; statusEl.classList.remove("is-loading","is-success","is-error"); if (state ==="loading") statusEl.classList.add("is-loading"); if (state ==="success") statusEl.classList.add("is-success"); if (state ==="error") statusEl.classList.add("is-error"); } function readJson_(k){ try{ return JSON.parse(sessionStorage.getItem(k) ||""); }catch(e){ return null; } } function loadAnyToken_(){ try{ const s = (sessionStorage.getItem(TOKEN_STORAGE) ||"").trim(); if (s) return s; }catch(e){} try{ const l = (localStorage.getItem(TOKEN_LOCAL) ||"").trim(); if (l) return l; }catch(e){} return""; } function jsonp_(url){ return new Promise((resolve, reject) => { const cb ="cb_" + Math.random().toString(36).slice(2); const s = document.createElement("script"); s.async = true; const cleanup = () => { try{ delete window[cb]; }catch(e){} try{ s.remove(); }catch(e){} }; window[cb] = (data) => { try{ resolve(data); } finally{ cleanup(); } }; s.onerror = () => { cleanup(); reject(new Error("JSONP failed to load")); }; s.src = url + (url.includes("?") ?"&" :"?") +"callback=" + cb; document.body.appendChild(s); }); } function b64_(obj){ const json = JSON.stringify(obj || {}); return btoa(unescape(encodeURIComponent(json))); } function getPayload_(){ return { saveAs: (el("saveAs").value ||"").trim(), clientName: (el("clientName").value ||"").trim(), billingMethod: el("billingMethod").value, currentAmount: Number(el("currentAmount").value || 0), weeksPerMonth: Number(el("weeksPerMonth").value || 0), taxRate: Number(el("taxRate").value || 0), strategy: el("strategy").value, addPerWeek: Number(el("addPerWeek").value || 0), addPerMonth: Number(el("addPerMonth").value || 0), clientTaxShare: Number(el("clientTaxShare").value || 0), targetNetPct: Number(el("targetNetPct").value || 1) }; } function explain_(computed){ const inp = computed?.inputs || {}; const disp = computed?.display || {}; if (!inp.strategy) return""; if (inp.strategy ==="Client pays % of tax (split)"){ return `Splitting sales tax — client pays ${disp.clientTaxShare ||""} of pass-through tax at ${disp.taxRate ||""}.`; } if (inp.strategy ==="Keep client total same (absorb tax)"){ return `Keeping total the same — business absorbs sales tax at ${disp.taxRate ||""}.`; } if (inp.strategy ==="Add $ per week") return"Adding a fixed increase per week."; if (inp.strategy ==="Add $ per month") return"Adding a fixed increase per month."; if (inp.strategy ==="Target my net revenue % (after tax)") return `Targeting net revenue at ${disp.targetNetPct ||""} after tax.`; return""; } function render_(computed, links){ const disp = computed.display; el("outputsCard").style.display =""; el("explain").textContent = explain_(computed); el("o_base").textContent = disp.newBaseTaxable; el("o_tax").textContent = disp.salesTaxLine; el("o_total").textContent = disp.newTotal; el("o_weekly").textContent = disp.weeklyTotal; el("o_old").textContent = disp.oldBase; el("o_pass").textContent = disp.passThroughIncrease; el("o_clientabs").textContent = disp.clientAbsorbs; el("o_bizabs").textContent = disp.businessAbsorbs; const linksEl = el("links"); if (links && (links.pdfUrl || links.docUrl)){ const parts = []; if (links.pdfUrl) parts.push(`<a href="${links.pdfUrl}" target="_blank" rel="noopener">Open PDF</a>`); if (links.docUrl) parts.push(`<a href="${links.docUrl}" target="_blank" rel="noopener">Open Doc</a>`); linksEl.innerHTML ="Links:" + parts.join(" ·"); } else { linksEl.innerHTML =""; } } async function call_(route, payload){ const p64 = b64_(payload); const url = `${LEGACY_API_URL}?route=${encodeURIComponent(route)}` + `&payload64=${encodeURIComponent(p64)}`; return jsonp_(url); } function boot_(){ apiHint.textContent = LEGACY_API_URL; // still require Admin Panel sign-in const auth = readJson_(AUTH_STORAGE); const token = loadAnyToken_(); if (!auth || !auth.ok || !token){ setStatus("Admin sign-in required. Redirecting…","error"); setTimeout(() => window.location.href ="/admin/", 700); return; } whoEl.textContent = `${auth.employeeId} • ${auth.employeeName ||""}`; setStatus("Ready.","success"); el("btnAdjust").onclick = async () => { try{ setStatus("Calculating…","loading"); const payload = getPayload_(); const res = await call_("legacy_adjust", payload); if (!res || !res.ok){ setStatus(`Error: ${res?.error ||"adjust failed"}`,"error"); return; } render_(res.computed); setStatus("Adjusted ✅","success"); }catch(e){ setStatus(String(e?.message || e),"error"); } }; el("btnExport").onclick = async () => { try{ const payload = getPayload_(); if (!payload.saveAs){ alert("Save As is required to generate the PDF."); return; } setStatus("Saving + generating Doc/PDF…","loading"); const res = await call_("legacy_export", payload); if (!res || !res.ok){ setStatus(`Error: ${res?.error ||"export failed"}`,"error"); return; } render_(res.computed, { pdfUrl: res.pdfUrl, docUrl: res.docUrl }); setStatus("Saved + PDF generated ✅","success"); }catch(e){ setStatus(String(e?.message || e),"error"); } }; } if (document.readyState ==="loading"){ document.addEventListener("DOMContentLoaded", boot_); } else { boot_(); } </script>
</div></main>
</body>
</html>
